<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Unix Terminal</title>
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background: #000;
            font-family: Consolas, "Lucida Console", monospace;
            overflow: hidden;
        }

        #site-container {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        #site-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        #blur-overlay {
            position: fixed;
            inset: 0;
            backdrop-filter: blur(18px);
            background: rgba(0, 0, 0, 0.55);
            z-index: 1;
            pointer-events: all;
        }

        #terminal-window {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 900px;
            height: 520px;
            transform: translate(-50%, -50%);
            background: #000;
            border: 2px solid #444;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.85);
            display: none;
            flex-direction: column;
            z-index: 2;
        }

        #title-bar {
            height: 32px;
            background: linear-gradient(#2b2b2b, #1c1c1c);
            color: #ddd;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-size: 14px;
            user-select: none;
            cursor: move;
        }

        #terminal {
            flex: 1;
            padding: 12px;
            color: #cfcfcf;
            font-size: 15px;
            overflow-y: auto;
            white-space: pre-wrap;
        }

        .prompt {
            color: #cfcfcf;
        }

        .input {
            color: #cfcfcf;
        }

        .success {
            color: #00ff6a;
        }

        .gems {
            color: #00a2ff;
        }

        .error {
            color: #ff4c4c;
        }

        .dim {
            color: #9a9a9a;
        }

        .cursor {
            display: inline-block;
            width: 8px;
            height: 16px;
            background: #cfcfcf;
            margin-left: 2px;
            animation: blink 1s steps(1) infinite;
        }

        @keyframes blink {
            50% {
                background: transparent;
            }
        }
    </style>
</head>

<body>

    <div id="site-container"><iframe src="https://deadshot.io"></iframe></div>
    <div id="blur-overlay"></div>
    <div id="terminal-window">
        <div id="title-bar">xterm</div>
        <div id="terminal"></div>
    </div>

    <script>
        const terminal = document.getElementById("terminal");
        const terminalWindow = document.getElementById("terminal-window");

        let inputBuffer = "";
        let state = "command";
        let tempGems = "";
        let tempUser = "";
        let activeInput = null;

        // Unix-style prompt
        let currentPrompt = "[guest@gen] # ";

        function print(text = "", cls = "") {
            const line = document.createElement("div");
            if (cls) line.className = cls;
            line.textContent = text;
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        function createPrompt() {
            const line = document.createElement("div");
            const prompt = document.createElement("span");
            prompt.className = "prompt";
            prompt.textContent = currentPrompt;  // dynamic prompt
            const input = document.createElement("span");
            input.className = "input";
            const cursor = document.createElement("span");
            cursor.className = "cursor";
            line.append(prompt, input, cursor);
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
            activeInput = input;
        }

        function closePrompt() {
            document.querySelectorAll(".cursor").forEach(c => c.remove());
            activeInput = null;
        }

        function handleCommand(cmd) {
            switch (cmd.toLowerCase()) {
                case "help":
                    print("Available commands:");
                    print("  ls");
                    print("  generate");
                    print("  generate.sh");
                    createPrompt();
                    break;
                case "ls":
                    print(`
generate.sh | 777
cd          | 000
pwd         | 111
rm          | 000
ls          | 111
`);
                    createPrompt();
                    break;
                case "generate":
                case "generate.sh":
                    print(`
    ____  ____  _________    ____  _____________   __
   / __ \/ __ \/ ____/   |  / __ \/ ____/ ____/ | / /
  / / / / /_/ / __/ / /| | / / / / / __/ __/ /  |/ / 
 / /_/ / _, _/ /___/ ___ |/ /_/ / /_/ / /___/ /|  /  
/_____/_/ |_/_____/_/  |_/_____/\____/_____/_/ |_/               
`, "gems");
                    currentPrompt = "# "; // inside generate.sh prompt
                    print("Enter amount of gems to generate:");
                    state = "gems";
                    createPrompt();
                    break;
                case "pwd":
                    print("/home/guest/GUESTENV");
                    createPrompt();
                    break;
                case "rm":
                case "cd":
                case "cd /":

                case "cd ..":
                    print(`Cannot execute ${cmd} as user doesn't have the permissions to execute.`, "error");
                    createPrompt();
                    break;
                case "":
                    createPrompt();
                    break;
                default:
                    print(`${cmd}: command not found`, "error");
                    createPrompt();
            }
        }

        function fakeGeneration(gems, user) {
            let tok = Array.from({ length: 32 }, () => Math.floor(Math.random() * 10)).join('');
            const steps = [
                "creating Google login token...",
                `recieved token. logged in as ${user}.`,
                `att 1: using d0pam1ne to leak Xsolla return token...`,
                `recieved: ${tok} `,
                `setting return address to recieved pointer...`,
                `CHECKMATE. returning to deadshot.io! `,
            ];
            let i = 0;
            const interval = setInterval(() => {
                print(steps[i], "success");
                i++;
                if (i === steps.length) {
                    clearInterval(interval);
                    const pid = Math.floor(1000 + Math.random() * 9000);
                    const addy = Array.from({ length: 16 }, () => Math.floor(Math.random() * 10)).join('');
                    print(`GENERATION FAILED.`, "error")
                    print(`Segmentation fault occured at 0x${addy} in process ${pid}`, "error");
                    currentPrompt = "[guest@gen] # "; // return to main prompt
                    state = "command";
                    createPrompt();
                }
            }, 600);
        }

        document.addEventListener("keydown", e => {
            if (!activeInput) return;
            if (e.key.length === 1 && !e.ctrlKey && !e.metaKey) {
                inputBuffer += e.key;
                activeInput.textContent = inputBuffer;
            } else if (e.key === "Backspace") {
                inputBuffer = inputBuffer.slice(0, -1);
                activeInput.textContent = inputBuffer;
            } else if (e.key === "Enter") {
                const entered = inputBuffer.trim();
                inputBuffer = "";
                closePrompt();
                if (state === "command") handleCommand(entered);
                else if (state === "gems") {
                    tempGems = entered;
                    print(`Gems: ${tempGems}`);
                    print("Enter username to send gems to:");
                    state = "username";
                    createPrompt();
                } else if (state === "username") {
                    tempUser = entered;
                    print(`Username: ${tempUser}`);
                    fakeGeneration(tempGems, tempUser);
                }
            }
        });

        /* DELAY TERMINAL APPEARANCE */
        setTimeout(() => {
            terminalWindow.style.display = "flex";
            print(`
Connecting to 127.0.0.1:22...
Added 127.0.0.1 to the list of known hosts.
Logging in as guest@gen-server
-------------------------------------------
Welcome to the Deadshot.io gems server.
Please run 'generate' below to start.
-------------------------------------------
    `);
            print("");
            createPrompt();
        }, 1500);

        /* DRAGGABLE WINDOW */
        const titleBar = document.getElementById("title-bar");
        let dragging = false, offsetX = 0, offsetY = 0;
        titleBar.addEventListener("mousedown", e => {
            dragging = true;
            const rect = terminalWindow.getBoundingClientRect();
            offsetX = e.clientX - rect.left;
            offsetY = e.clientY - rect.top;
        });
        document.addEventListener("mousemove", e => {
            if (!dragging) return;
            terminalWindow.style.left = `${e.clientX - offsetX}px`;
            terminalWindow.style.top = `${e.clientY - offsetY}px`;
            terminalWindow.style.transform = "none";
        });
        document.addEventListener("mouseup", () => dragging = false);
    </script>
</body>

</html>